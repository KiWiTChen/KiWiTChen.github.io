<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="启动模式 stm32有多种启动模式，以STM32F4XX为例，如下图所示：\n并非所有芯片都适用于这个表格，不同型号具体启动方式请参考对应手册,官方也有Bootloader介绍文档可以查看。\n">
<title>Stm32学习小记（三）——STM32_Cortex M启动流程详解</title>

<link rel='canonical' href='https://KiWiTChen.github.io/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%89stm32_cortex-m%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Stm32学习小记（三）——STM32_Cortex M启动流程详解">
<meta property='og:description' content="启动模式 stm32有多种启动模式，以STM32F4XX为例，如下图所示：\n并非所有芯片都适用于这个表格，不同型号具体启动方式请参考对应手册,官方也有Bootloader介绍文档可以查看。\n">
<meta property='og:url' content='https://KiWiTChen.github.io/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%89stm32_cortex-m%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/'>
<meta property='og:site_name' content='KiWiT'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-03-24T00:31:15&#43;08:00'/><meta property='article:modified_time' content='2025-03-24T00:31:15&#43;08:00'/>
<meta name="twitter:title" content="Stm32学习小记（三）——STM32_Cortex M启动流程详解">
<meta name="twitter:description" content="启动模式 stm32有多种启动模式，以STM32F4XX为例，如下图所示：\n并非所有芯片都适用于这个表格，不同型号具体启动方式请参考对应手册,官方也有Bootloader介绍文档可以查看。\n">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_fc2b629155691b95.png" width="300"
                            height="378" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🥰​</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">KiWiT</a></h1>
            <h2 class="site-description">欢迎来到我的博客，在这里我会分享一些自己的学习日常，如果有相关问题，也欢迎私信讨论</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/492418934'
                        target="_blank"
                        title="Blibili"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.0.0-beta2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M488.6 104.1C505.3 122.2 513 143.8 511.9 169.8V372.2C511.5 398.6 502.7 420.3 485.4 437.3C468.2 454.3 446.3 463.2 419.9 464H92.02C65.57 463.2 43.81 454.2 26.74 436.8C9.682 419.4 .7667 396.5 0 368.2V169.8C.7667 143.8 9.682 122.2 26.74 104.1C43.81 87.75 65.57 78.77 92.02 78H121.4L96.05 52.19C90.3 46.46 87.42 39.19 87.42 30.4C87.42 21.6 90.3 14.34 96.05 8.603C101.8 2.868 109.1 0 117.9 0C126.7 0 134 2.868 139.8 8.603L213.1 78H301.1L375.6 8.603C381.7 2.868 389.2 0 398 0C406.8 0 414.1 2.868 419.9 8.603C425.6 14.34 428.5 21.6 428.5 30.4C428.5 39.19 425.6 46.46 419.9 52.19L394.6 78L423.9 78C450.3 78.77 471.9 87.75 488.6 104.1H488.6zM449.8 173.8C449.4 164.2 446.1 156.4 439.1 150.3C433.9 144.2 425.1 140.9 416.4 140.5H96.05C86.46 140.9 78.6 144.2 72.47 150.3C66.33 156.4 63.07 164.2 62.69 173.8V368.2C62.69 377.4 65.95 385.2 72.47 391.7C78.99 398.2 86.85 401.5 96.05 401.5H416.4C425.6 401.5 433.4 398.2 439.7 391.7C446 385.2 449.4 377.4 449.8 368.2L449.8 173.8zM185.5 216.5C191.8 222.8 195.2 230.6 195.6 239.7V273C195.2 282.2 191.9 289.9 185.8 296.2C179.6 302.5 171.8 305.7 162.2 305.7C152.6 305.7 144.7 302.5 138.6 296.2C132.5 289.9 129.2 282.2 128.8 273V239.7C129.2 230.6 132.6 222.8 138.9 216.5C145.2 210.2 152.1 206.9 162.2 206.5C171.4 206.9 179.2 210.2 185.5 216.5H185.5zM377 216.5C383.3 222.8 386.7 230.6 387.1 239.7V273C386.7 282.2 383.4 289.9 377.3 296.2C371.2 302.5 363.3 305.7 353.7 305.7C344.1 305.7 336.3 302.5 330.1 296.2C323.1 289.9 320.7 282.2 320.4 273V239.7C320.7 230.6 324.1 222.8 330.4 216.5C336.7 210.2 344.5 206.9 353.7 206.5C362.9 206.9 370.7 210.2 377 216.5H377z"/></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/KiWiTChen'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%8F%8B%E9%93%BE/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>友链</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#第一种启动方式">第一种启动方式</a></li>
    <li><a href="#第二种启动方式">第二种启动方式</a></li>
    <li><a href="#第三种启动方式">第三种启动方式</a></li>
  </ol>

  <ol>
    <li><a href="#内存分布">内存分布</a>
      <ol>
        <li><a href="#６个储存数据段">６个储存数据段</a></li>
        <li><a href="#3种储存属性区">3种储存属性区</a></li>
        <li><a href="#小结">小结</a></li>
      </ol>
    </li>
    <li><a href="#代码详解">代码详解</a></li>
  </ol>

  <ol>
    <li><a href="#地址映射">地址映射</a></li>
    <li><a href="#硬件自动为msp和pc赋值开始执行reset_handler">硬件自动为MSP和PC赋值,开始执行reset_handler</a></li>
    <li><a href="#system_init">System_Init</a></li>
    <li><a href="#__main">__main</a>
      <ol>
        <li>
          <ol>
            <li><a href="#__scatterload分散加载">__scatterload(分散加载)</a></li>
            <li><a href="#__rt_entry">__rt_entry</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%89stm32_cortex-m%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/">Stm32学习小记（三）——STM32_Cortex M启动流程详解</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 24, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 9 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="启动模式">启动模式
</h1><p>stm32有多种启动模式，以STM32F4XX为例，如下图所示：</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%89stm32_cortex-m%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/index.assets/image-20250323222017423.png"
	width="712"
	height="189"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%89stm32_cortex-m%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/index.assets/image-20250323222017423_hu_bad8bbfe916f1106.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%89stm32_cortex-m%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/index.assets/image-20250323222017423_hu_c95a3b402408ac51.png 1024w"
	loading="lazy"
	
		alt="image-20250323222017423"
	
	
		class="gallery-image" 
		data-flex-grow="376"
		data-flex-basis="904px"
	
></p>
<blockquote>
<p>并非所有芯片都适用于这个表格，不同型号具体启动方式请参考对应手册,官方也有Bootloader介绍文档可以查看。</p></blockquote>
<h2 id="第一种启动方式">第一种启动方式
</h2><p>最常用的用户FLASH启动，正常工作就在这种模式下，STM32的FLASH可以擦除10万次，所以不用担心芯片哪天会被擦爆。</p>
<h2 id="第二种启动方式">第二种启动方式
</h2><p>系统存储器启动方式，使用串口下载程序或者使用USB-DFU模式下载程序，不建议使用这种，速度比较慢。STM32 中自带的BootLoader就是在这种启动方式中，如果出现程序硬件错误的话可以切换BOOT0/1到该模式下重新烧写Flash即可恢复正常。</p>
<h2 id="第三种启动方式">第三种启动方式
</h2><p>STM32内嵌的SRAM启动，一般该模式用于调试。 用J-Link在线仿真，则是下载到SRAM中。</p>
<h1 id="启动文件">启动文件
</h1><h2 id="内存分布">内存分布
</h2><p>STM32的数据在物理上分别储存在RAM和Flash中。</p>
<p>RAM可读可写，<strong>掉电清零</strong>。Flash可读可写，但是读写时间很长，能<strong>掉电储存</strong>，并且一般空间比RAM大很多。</p>
<p>下图是STM32F4XX的Memory Map,可以看到，其FLASH起始地址为0x0800 0000,大小为512KB</p>
<img src="index.assets/image-20250323224252499.png" alt="image-20250323224252499" style="zoom: 80%;" />
<p>那么FLASH和RAM主要存储哪些数据呢？这里又涉及到了<strong>６个储存数据段</strong>和<strong>３种储存属性区</strong>的概念，可以参考<a class="link" href="https://blog.csdn.net/xingqingly/article/details/120260398"  target="_blank" rel="noopener"
    >这篇博客</a>。</p>
<img src="index.assets/image-20250323225520275.png" alt="image-20250323225520275" style="zoom:50%;" />
<h3 id="６个储存数据段">６个储存数据段
</h3><p><strong>data</strong>
数据段，储存已初始化的，且初始化不为0的全局变量和静态变量。</p>
<p><strong>bss</strong>
Block Started by Symbol。储存未初始化的，或初始化为0的全局变量和静态变量。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">c</span><span class="p">;</span><span class="c1">//这里c会被放入BSS区域，后续会对其赋初始值为0
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>text</strong>
用户的代码段，储存程序代码。</p>
<p><strong>constdata</strong>
储存只读常量。</p>
<p><strong>heap</strong>
堆，存放进程运行中被动态分配的内存段。其可用大小定义在启动文件startup_stm32fxx.s中，由程序员使用malloc()和free()函数进行分配和释放。</p>
<p><strong>stack</strong>
栈，其大小定义在启动文件startup_stm32fxx.s中，由系统自动分配和释放。可存放局部变量、函数的参数和返回值，中断发生时能保存现场。但是static声明的局部静态变量不储存在栈中，而是放在data数据段。</p>
<h3 id="3种储存属性区">3种储存属性区
</h3><p><strong>RO(Read Only)</strong>
烧写到Flash中，可以长久保存。text代码段和constdata都属于RO。由于需要掉电储存，RO里也保存了一份data的数据。</p>
<p><strong>RW(Read Write)</strong>
储存在RAM中。data属于此区。上电时单片机会将Flash中保存的data类型数据复制到RAM中，以供读写使用。</p>
<p><strong>ZI(Zero Init)</strong>
零初始化区，同样储存在RAM里。系统上电时会把此区域的数据进行0初始化。bss，heap，stack均属于这个区域。</p>
<h3 id="小结">小结
</h3><p>链接时记录bss段大小，装载（后续会提到）时分配空间</p>
<p>FLASH：Code + RO-Data + RW-Data（运行时搬运到RAM里面）</p>
<p>SRAM： RW-Data + ZI-Data</p>
<h2 id="代码详解">代码详解
</h2><p>打开startup_stm32f40_41xxx.s文件，我们可以查看详细启动文件代码。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Stack_Size      EQU     0x400
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                AREA    STACK, NOINIT, READWRITE, ALIGN=3
</span></span><span class="line"><span class="cl">Stack_Mem       SPACE   Stack_Size
</span></span><span class="line"><span class="cl">__initial_sp
</span></span></code></pre></td></tr></table>
</div>
</div><p>分配了一段大小为1KB的栈空间，段名STACK，可读写，ALIGN=3表示2^3=8字节对齐，&quot;_ _initial_sp&quot;紧挨着栈的结束地址，由于栈是从高往低生长，所以&quot;__initial_sp&quot;的位置就是栈顶。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Heap_Size      EQU     0x200
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                AREA    HEAP, NOINIT, READWRITE, ALIGN=3
</span></span><span class="line"><span class="cl">__heap_base
</span></span><span class="line"><span class="cl">Heap_Mem        SPACE   Heap_Size
</span></span><span class="line"><span class="cl">__heap_limit
</span></span></code></pre></td></tr></table>
</div>
</div><p>分配了一段大小为512字节的堆空间，段名HEAP，可读可写，8字节对齐，__heap_base和__heap_limit分别是堆的起始地址和结束地址。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">                PRESERVE8
</span></span><span class="line"><span class="cl">                THUMB
</span></span></code></pre></td></tr></table>
</div>
</div><p>指定当前文件的堆栈按照8字节对齐，后面指令兼容16位的Thumb指令。Cortex-M内核实际使用的是Thumb-2指令集，将16位与32位指令混合使用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">                AREA    RESET, DATA, READONLY
</span></span><span class="line"><span class="cl">                EXPORT  __Vectors
</span></span><span class="line"><span class="cl">                EXPORT  __Vectors_End
</span></span><span class="line"><span class="cl">                EXPORT  __Vectors_Size
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">__Vectors       DCD     __initial_sp               ; Top of Stack
</span></span><span class="line"><span class="cl">                DCD     Reset_Handler              ; Reset Handler
</span></span><span class="line"><span class="cl">                DCD     NMI_Handler                ; NMI Handler
</span></span><span class="line"><span class="cl">                DCD     HardFault_Handler          ; Hard Fault Handler
</span></span><span class="line"><span class="cl">                DCD     MemManage_Handler          ; MPU Fault Handler
</span></span><span class="line"><span class="cl">                DCD     BusFault_Handler           ; Bus Fault Handler
</span></span><span class="line"><span class="cl">                DCD     UsageFault_Handler         ; Usage Fault Handler
</span></span><span class="line"><span class="cl">                DCD     0                          ; Reserved
</span></span><span class="line"><span class="cl">                DCD     0                          ; Reserved
</span></span><span class="line"><span class="cl">                DCD     0                          ; Reserved
</span></span><span class="line"><span class="cl">                DCD     0                          ; Reserved
</span></span><span class="line"><span class="cl">                DCD     SVC_Handler                ; SVCall Handler
</span></span><span class="line"><span class="cl">                DCD     DebugMon_Handler           ; Debug Monitor Handler
</span></span><span class="line"><span class="cl">                DCD     0                          ; Reserved
</span></span><span class="line"><span class="cl">                DCD     PendSV_Handler             ; PendSV Handler
</span></span><span class="line"><span class="cl">                DCD     SysTick_Handler            ; SysTick Handler
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                ; External Interrupts
</span></span><span class="line"><span class="cl">                DCD     WWDG_IRQHandler                   ; Window WatchDog
</span></span><span class="line"><span class="cl">                DCD     PVD_IRQHandler                    ; PVD through EXTI Line detection
</span></span><span class="line"><span class="cl">                …………
</span></span><span class="line"><span class="cl">                DCD     0                                 ; Reserved
</span></span><span class="line"><span class="cl">                DCD     SPI4_IRQHandler                   ; SPI4
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">__Vectors_End
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">__Vectors_Size  EQU  __Vectors_End - __Vectors
</span></span></code></pre></td></tr></table>
</div>
</div><p>定义了一个数据段，名为DATA，仅可读。</p>
<p>上文为堆栈分配的空间均位于SRAM中，不占用代码空间，从这个数据段开始才是stm32代码空间的起始位置，先定义并初始化了栈顶位置（_ _initial_sp）以及15个内核异常处理函数的入口地址，接下来是外部中断，最后用结束地址减去开始地址得到__Vectors_Size即本数据段的大小。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Reset_Handler    PROC
</span></span><span class="line"><span class="cl">                 EXPORT  Reset_Handler             [WEAK]
</span></span><span class="line"><span class="cl">        IMPORT  SystemInit
</span></span><span class="line"><span class="cl">        IMPORT  __main
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                 LDR     R0, =SystemInit
</span></span><span class="line"><span class="cl">                 BLX     R0
</span></span><span class="line"><span class="cl">                 LDR     R0, =__main
</span></span><span class="line"><span class="cl">                 BX      R0
</span></span><span class="line"><span class="cl">                 ENDP
</span></span></code></pre></td></tr></table>
</div>
</div><p>reset_handler即复位程序的实际执行代码，上电或是复位都会先从这里开始执行然后进入main函数，具体的执行过程暂且按下不表，我们继续看启动文件的后续内容。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">NMI_Handler     PROC
</span></span><span class="line"><span class="cl">                EXPORT  NMI_Handler                [WEAK]
</span></span><span class="line"><span class="cl">                B       .
</span></span><span class="line"><span class="cl">                ENDP
</span></span><span class="line"><span class="cl">HardFault_Handler\
</span></span><span class="line"><span class="cl">                PROC
</span></span><span class="line"><span class="cl">                EXPORT  HardFault_Handler          [WEAK]
</span></span><span class="line"><span class="cl">                B       .
</span></span><span class="line"><span class="cl">                ENDP   
</span></span><span class="line"><span class="cl">…………
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">SysTick_Handler PROC
</span></span><span class="line"><span class="cl">                EXPORT  SysTick_Handler            [WEAK]
</span></span><span class="line"><span class="cl">                B       .
</span></span><span class="line"><span class="cl">                ENDP
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Default_Handler PROC
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                EXPORT  WWDG_IRQHandler                   [WEAK]                         
</span></span><span class="line"><span class="cl">                EXPORT  PVD_IRQHandler                    [WEAK]                      
</span></span><span class="line"><span class="cl">                EXPORT  TAMP_STAMP_IRQHandler             [WEAK]  
</span></span><span class="line"><span class="cl">                …………
</span></span><span class="line"><span class="cl">                EXPORT  SPI4_IRQHandler                   [WEAK]
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">WWDG_IRQHandler                                                       
</span></span><span class="line"><span class="cl">PVD_IRQHandler                                      
</span></span><span class="line"><span class="cl">TAMP_STAMP_IRQHandler
</span></span><span class="line"><span class="cl">…………
</span></span><span class="line"><span class="cl">SPI4_IRQHandler
</span></span><span class="line"><span class="cl">           
</span></span><span class="line"><span class="cl">                B       .
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                ENDP
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                ALIGN
</span></span></code></pre></td></tr></table>
</div>
</div><p>将除了reset_handler外的内核异常都分别写成无限循环（B .）的弱函数，外部中断也是如此，只是函数起始位置都是同一个地址。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">                 IF      :DEF:__MICROLIB
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                 EXPORT  __initial_sp
</span></span><span class="line"><span class="cl">                 EXPORT  __heap_base
</span></span><span class="line"><span class="cl">                 EXPORT  __heap_limit
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                 ELSE
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                 IMPORT  __use_two_region_memory
</span></span><span class="line"><span class="cl">                 EXPORT  __user_initial_stackheap
</span></span><span class="line"><span class="cl">                 
</span></span><span class="line"><span class="cl">__user_initial_stackheap
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                 LDR     R0, =  Heap_Mem
</span></span><span class="line"><span class="cl">                 LDR     R1, =(Stack_Mem + Stack_Size)
</span></span><span class="line"><span class="cl">                 LDR     R2, = (Heap_Mem +  Heap_Size)
</span></span><span class="line"><span class="cl">                 LDR     R3, = Stack_Mem
</span></span><span class="line"><span class="cl">                 BX      LR
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                 ALIGN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                 ENDIF
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                 END
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果使用了microlib则将栈顶地址和堆的起始、结束地址export出去，microlib会进行堆栈初始化的操作，若是没有使用，则堆栈初始化时会使用__user_initial_stackheap函数。</p>
<h1 id="启动流程">启动流程
</h1><h2 id="地址映射">地址映射
</h2><p>STM32的代码是烧写到flash中的，通过查询手册可知，STM32F401XX的flash的起始地址是0x08000000；当然通过KEIL已配置好的工程也能查看flash信息：</p>
<img src="index.assets/image-20250323232221995.png" alt="image-20250323232221995" style="zoom: 80%;" />
<p>但是Cortex-M内核规定上电后必须从0x00000000的位置开始执行，这就需要一个<strong>地址映射</strong>的操作，不论stm32的启动模式是本文开头说的哪一种，都会将该启动区域的代码映射到0x00000000的位置，进入keil的调试模式打开memory窗口，输入查看0x00000000和0x08000000：</p>
<img src="index.assets/image-20250323232707187.png" alt="image-20250323232707187" style="zoom:80%;" />
<img src="index.assets/image-20250323232808393.png" alt="image-20250323232808393" style="zoom:80%;" />
<p>我们可以发现数据是完全相同的。</p>
<p>通过地址映射机制，同一份代码可通过硬件配置在不同启动模式下运行，用户不需要关心物理地址的具体位置，只需使用链接脚本将代码和数据分配到正确的地址区域。例如，中断向量表默认放在Flash的起始位置，但通过VTOR寄存器可以重定位到SRAM，这种灵活性在调试或需要动态加载代码时非常有用，从而提高了开发效率</p>
<h2 id="硬件自动为msp和pc赋值开始执行reset_handler">硬件自动为MSP和PC赋值,开始执行reset_handler
</h2><p>分析启动代码时我们提到过，从DATA段开始才是代码段的起始位置，那么0x08000000作为起始地址的4字节空间存储的就是__initial_sp的地址，即栈顶地址，上电或复位后，硬件会自动将该地址赋给<strong>MSP</strong>，即主栈指针，随后将0x08000004作为起始地址的4字节空间内容，也就是reset_handler函数入口地址赋给<strong>PC</strong>。</p>
<p>此时程序会立刻去执行<strong>reset_handler</strong>，让我们回过头来看看reset_handler中做了些什么：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Reset_Handler    PROC
</span></span><span class="line"><span class="cl">                 EXPORT  Reset_Handler             [WEAK]
</span></span><span class="line"><span class="cl">        IMPORT  SystemInit
</span></span><span class="line"><span class="cl">        IMPORT  __main
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                 LDR     R0, =SystemInit
</span></span><span class="line"><span class="cl">                 BLX     R0
</span></span><span class="line"><span class="cl">                 LDR     R0, =__main
</span></span><span class="line"><span class="cl">                 BX      R0
</span></span><span class="line"><span class="cl">                 ENDP
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到，reset_handler中执行了两个程序，<strong>SystemInit</strong>和**__main**。</p>
<h2 id="system_init">System_Init
</h2><p>不同型号芯片的默认systeminit函数有所区别，内容往往是初始化时钟、FPU等。</p>
<p>用户没有重写&quot;_ _main&quot;的情况下，该函数并不在库文件中，而是由armlink创建，如果想要在keil调试的时候查看__main的具体执行过程，需要在BX R0指令运行前点击汇编代码的内容框，再继续单步执行，则可以看到 _ _main的汇编代码，否则会直接跳进main函数。</p>
<img src="index.assets/image-20250324000905773.png" alt="image-20250324000905773" style="zoom:80%;" />
<h2 id="__main">__main
</h2><p>_ _main中调用了 _ _scatterload和 _ _rt_entry两个函数：</p>
<h4 id="__scatterload分散加载">__scatterload(分散加载)
</h4><p>默认的__scatterload函数做了两件事：</p>
<p>1.将ZI段数据全部初始化为0</p>
<p>2.将“非根区域”的数据从加载域复制到执行域（将可读可写的数据搬运到RAM）</p>
<p>在keil工程目录下的${工程名}.sct文件中可以查看加载域和执行域的地址以及数据存储位置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">;</span> <span class="o">*************************************************************</span>
</span></span><span class="line"><span class="cl"><span class="p">;</span> <span class="o">***</span> <span class="n">Scatter</span><span class="o">-</span><span class="n">Loading</span> <span class="n">Description</span> <span class="ne">File</span> <span class="n">generated</span> <span class="n">by</span> <span class="n">uVision</span> <span class="o">***</span>
</span></span><span class="line"><span class="cl"><span class="p">;</span> <span class="o">*************************************************************</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">LR_IROM1</span> <span class="mh">0x08000000</span> <span class="mh">0x00080000</span>  <span class="p">{</span>    <span class="p">;</span> <span class="nb">load</span> <span class="n">region</span> <span class="n">size_region</span>
</span></span><span class="line"><span class="cl">  <span class="n">ER_IROM1</span> <span class="mh">0x08000000</span> <span class="mh">0x00080000</span>  <span class="p">{</span>  <span class="p">;</span> <span class="nb">load</span> <span class="n">address</span> <span class="o">=</span> <span class="n">execution</span> <span class="n">address</span>
</span></span><span class="line"><span class="cl">   <span class="o">*.</span><span class="n">o</span> <span class="p">(</span><span class="n">RESET</span><span class="p">,</span> <span class="o">+</span><span class="n">First</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">*</span><span class="p">(</span><span class="n">InRoot</span><span class="o">$$</span><span class="n">Sections</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">.</span><span class="n">ANY</span> <span class="p">(</span><span class="o">+</span><span class="n">RO</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">.</span><span class="n">ANY</span> <span class="p">(</span><span class="o">+</span><span class="n">XO</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">RW_IRAM1</span> <span class="mh">0x20000000</span> <span class="mh">0x00018000</span>  <span class="p">{</span>  <span class="p">;</span> <span class="n">RW</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">   <span class="o">.</span><span class="n">ANY</span> <span class="p">(</span><span class="o">+</span><span class="n">RW</span> <span class="o">+</span><span class="n">ZI</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到，加载域的地址就是flash的地址，且只读的数据（RO、XO）放在flash（0x08000000&ndash;0x08080000）中，可读可写的数据（RW、ZI）放在RAM（0x20000000&ndash;0x20018000）中。</p>
<h4 id="__rt_entry">__rt_entry
</h4><p>_ _scatterload函数执行完后接着调用 _ _rt_entry， _ _rt_entry又调用了如下函数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">_platfoem_pre_stackheap_init
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">__user_setup_stackheap **or** setup the Stack Pointer(SP) by another method
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">_platfoem_post_stackheap_init
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">__rt_lib_init
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">_platfoem_post_lib_init
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">main()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">exit()
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中__user_setup_stackheap就是启动文件末尾的函数，如果没有使用microlib的话就会调用它。</p>
<p>__rt_entry负责初始化堆栈以及C语言库子系统，即C语言代码运行所必需的环境，随后万事俱备，就可以跳入main函数执行C语言代码了。</p>
<p>当然，如果没有在main函数中写死循环的话，main函数执行完了后会到达exit退出程序。</p>
<h1 id="总结">总结
</h1><p>总结一下，芯片上电第一件事是把代码空间的第一行，即<strong>栈顶指针</strong>赋给msp，随后将第二行reset_handler的<strong>入口地址</strong>赋给pc，使程序立刻跳转去执行<strong>reset_handler</strong>，在reset_handler中先初始化时钟、FPU等硬件相关配置（具体内容根据芯片型号有所不同），再初始化ZI段，将代码和数据从加载域<strong>搬运</strong>到执行域，随后初始化堆栈和C语言库子系统，使得C语言代码能够正常运行，最后跳入<strong>main函数执行</strong>用户编写的C程序。</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2024 - 
        
        2025 KiWiT
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.27.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
