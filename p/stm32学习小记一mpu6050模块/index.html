<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="[TOC]\nMPU6050介绍 MPU6050简介 mpu6050是一款多轴传感器融合的运动处理模块，它具有一个嵌入式3轴MEMS陀螺仪，一个3轴MEMS加速度计以及一个DMP硬件加速引擎，通过I2C通信接口，mpu6050模块可将整合的加速度以及角加速度信息发送到终端MCU，供设备使用。这一特性使其广泛运用于手机、平板、游戏控制器、可穿戴式设备等领域。\n">
<title>Stm32学习小记（一）——MPU6050模块</title>

<link rel='canonical' href='https://KiWiTChen.github.io/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Stm32学习小记（一）——MPU6050模块">
<meta property='og:description' content="[TOC]\nMPU6050介绍 MPU6050简介 mpu6050是一款多轴传感器融合的运动处理模块，它具有一个嵌入式3轴MEMS陀螺仪，一个3轴MEMS加速度计以及一个DMP硬件加速引擎，通过I2C通信接口，mpu6050模块可将整合的加速度以及角加速度信息发送到终端MCU，供设备使用。这一特性使其广泛运用于手机、平板、游戏控制器、可穿戴式设备等领域。\n">
<meta property='og:url' content='https://KiWiTChen.github.io/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/'>
<meta property='og:site_name' content='KiWiT'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-09-22T22:56:45&#43;08:00'/><meta property='article:modified_time' content='2024-09-22T22:56:45&#43;08:00'/>
<meta name="twitter:title" content="Stm32学习小记（一）——MPU6050模块">
<meta name="twitter:description" content="[TOC]\nMPU6050介绍 MPU6050简介 mpu6050是一款多轴传感器融合的运动处理模块，它具有一个嵌入式3轴MEMS陀螺仪，一个3轴MEMS加速度计以及一个DMP硬件加速引擎，通过I2C通信接口，mpu6050模块可将整合的加速度以及角加速度信息发送到终端MCU，供设备使用。这一特性使其广泛运用于手机、平板、游戏控制器、可穿戴式设备等领域。\n">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu8414970003043308804.png" width="300"
                            height="378" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🥰​</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">KiWiT</a></h1>
            <h2 class="site-description">欢迎来到我的博客，在这里我会分享一些自己的学习日常，如果有相关问题，也欢迎私信讨论</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/492418934'
                        target="_blank"
                        title="Blibili"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.0.0-beta2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M488.6 104.1C505.3 122.2 513 143.8 511.9 169.8V372.2C511.5 398.6 502.7 420.3 485.4 437.3C468.2 454.3 446.3 463.2 419.9 464H92.02C65.57 463.2 43.81 454.2 26.74 436.8C9.682 419.4 .7667 396.5 0 368.2V169.8C.7667 143.8 9.682 122.2 26.74 104.1C43.81 87.75 65.57 78.77 92.02 78H121.4L96.05 52.19C90.3 46.46 87.42 39.19 87.42 30.4C87.42 21.6 90.3 14.34 96.05 8.603C101.8 2.868 109.1 0 117.9 0C126.7 0 134 2.868 139.8 8.603L213.1 78H301.1L375.6 8.603C381.7 2.868 389.2 0 398 0C406.8 0 414.1 2.868 419.9 8.603C425.6 14.34 428.5 21.6 428.5 30.4C428.5 39.19 425.6 46.46 419.9 52.19L394.6 78L423.9 78C450.3 78.77 471.9 87.75 488.6 104.1H488.6zM449.8 173.8C449.4 164.2 446.1 156.4 439.1 150.3C433.9 144.2 425.1 140.9 416.4 140.5H96.05C86.46 140.9 78.6 144.2 72.47 150.3C66.33 156.4 63.07 164.2 62.69 173.8V368.2C62.69 377.4 65.95 385.2 72.47 391.7C78.99 398.2 86.85 401.5 96.05 401.5H416.4C425.6 401.5 433.4 398.2 439.7 391.7C446 385.2 449.4 377.4 449.8 368.2L449.8 173.8zM185.5 216.5C191.8 222.8 195.2 230.6 195.6 239.7V273C195.2 282.2 191.9 289.9 185.8 296.2C179.6 302.5 171.8 305.7 162.2 305.7C152.6 305.7 144.7 302.5 138.6 296.2C132.5 289.9 129.2 282.2 128.8 273V239.7C129.2 230.6 132.6 222.8 138.9 216.5C145.2 210.2 152.1 206.9 162.2 206.5C171.4 206.9 179.2 210.2 185.5 216.5H185.5zM377 216.5C383.3 222.8 386.7 230.6 387.1 239.7V273C386.7 282.2 383.4 289.9 377.3 296.2C371.2 302.5 363.3 305.7 353.7 305.7C344.1 305.7 336.3 302.5 330.1 296.2C323.1 289.9 320.7 282.2 320.4 273V239.7C320.7 230.6 324.1 222.8 330.4 216.5C336.7 210.2 344.5 206.9 353.7 206.5C362.9 206.9 370.7 210.2 377 216.5H377z"/></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/KiWiTChen'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%8F%8B%E9%93%BE/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>友链</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#mpu6050简介">MPU6050简介</a></li>
    <li><a href="#硬件电路及引脚定义">硬件电路及引脚定义</a></li>
    <li><a href="#数据采集和传输原理">数据采集和传输原理</a></li>
  </ol>

  <ol>
    <li><a href="#通讯特点">通讯特点</a></li>
    <li><a href="#i2c时序">I2C时序</a>
      <ol>
        <li><a href="#基本单元">基本单元</a></li>
        <li><a href="#时序实例">时序实例</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#mpu5060寄存器配置">MPU5060寄存器配置</a>
      <ol>
        <li><a href="#采样频率分频器smprt_div">采样频率分频器SMPRT_DIV</a></li>
        <li><a href="#配置寄存器config">配置寄存器CONFIG</a></li>
        <li><a href="#陀螺仪配置寄存器gyro_config">陀螺仪配置寄存器GYRO_CONFIG</a></li>
        <li><a href="#加速度计配置寄存器accel_config">加速度计配置寄存器ACCEL_CONFIG</a></li>
        <li><a href="#数据寄存器加速度陀螺仪温度计等">数据寄存器（加速度、陀螺仪、温度计等）</a></li>
      </ol>
    </li>
    <li><a href="#库函数代码配置">库函数代码配置</a>
      <ol>
        <li><a href="#sclsda的读写函数">SCL、SDA的读写函数</a></li>
        <li><a href="#起始和终止函数">起始和终止函数</a></li>
        <li><a href="#i2c发送与接收数据">I2C发送与接收数据</a></li>
        <li><a href="#发送与接收应答">发送与接收应答</a></li>
        <li><a href="#读写mpu6050的寄存器">读写MPU6050的寄存器</a></li>
        <li><a href="#mpu6050初始化">MPU6050初始化</a></li>
        <li><a href="#读取mpu6050数据">读取MPU6050数据</a></li>
        <li><a href="#主函数编写">主函数编写</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#库函数实现usart串口初始化">库函数实现USART串口初始化</a></li>
    <li><a href="#编写串口发送函数">编写串口发送函数</a></li>
    <li><a href="#printf函数的重定向">printf函数的重定向</a></li>
    <li><a href="#封装mpu6050数据发送函数">封装MPU6050数据发送函数</a></li>
    <li><a href="#主函数编写-1">主函数编写</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/">Stm32学习小记（一）——MPU6050模块</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Sep 22, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 9 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>[TOC]</p>
<h1 id="mpu6050介绍">MPU6050介绍
</h1><h2 id="mpu6050简介">MPU6050简介
</h2><p>mpu6050是一款多轴传感器融合的运动处理模块，它具有一个嵌入式<strong>3轴MEMS陀螺仪</strong>，一个<strong>3轴MEMS加速度计</strong>以及一个<strong>DMP</strong>硬件加速引擎，通过I2C通信接口，mpu6050模块可将整合的加速度以及角加速度信息发送到终端MCU，供设备使用。这一特性使其广泛运用于手机、平板、游戏控制器、可穿戴式设备等领域。</p>
<blockquote>
<p>在江科大提供的模块资料中，我们可以找到product specification和register map手册，但是英文版手册难以阅读，这时可以使用翻译网站<a class="link" href="https://www.deepl.com/translator"  target="_blank" rel="noopener"
    >DeepL翻译：全世界最准确的翻译</a>进行pdf、word等格式手册的自动翻译，使用效果还是非常不错的。</p>
</blockquote>
<h2 id="硬件电路及引脚定义">硬件电路及引脚定义
</h2><p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202111016010.png"
	width="1026"
	height="601"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202111016010_hu4780308858532440570.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202111016010_hu3208935474437785684.png 1024w"
	loading="lazy"
	
		alt="image-20231202111016010"
	
	
		class="gallery-image" 
		data-flex-grow="170"
		data-flex-basis="409px"
	
></p>
<ol>
<li>I2C通信SCL、SDA：引脚23、24，内置了4.7k的两个上拉电阻。</li>
<li>电源引脚VDD、GND：引脚13、18。</li>
<li>主机I2C引脚XCL、XDA：额外的I2C通信引脚，连接外部磁力传感器，可通过DMP向应用输出完整的9轴融合演算数据。</li>
<li>地址AD0引脚：设置通信中的从机地址，若引脚不接（接地状态）则地址为0x68；若接入高电平，则为0x69。</li>
<li>中断引脚INT：通过设置相应寄存器，可以实现中断的配置。</li>
</ol>
<h2 id="数据采集和传输原理">数据采集和传输原理
</h2><p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202121918447.png"
	width="1188"
	height="863"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202121918447_hu16093267902808380463.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202121918447_hu16307649474403548362.png 1024w"
	loading="lazy"
	
		alt="image-20231202121918447"
	
	
		class="gallery-image" 
		data-flex-grow="137"
		data-flex-basis="330px"
	
></p>
<p>使能后MPU6050进入自测状态(self test)，若满足自测响应值在预设范围内（下式），则可以正常使用。
</p>
$$
\mid 使能前的值-使能后的值\mid<\Delta c
$$<p>
之后陀螺仪和角加速度计采集数据，经过ADC模数转换器处理后传到sensor registers，结合DMP可对相应数据解算，得到MPU6050的姿态信息。</p>
<h1 id="i2c通信协议">I2C通信协议
</h1><h2 id="通讯特点">通讯特点
</h2><ul>
<li>
<p><strong>两根通信线</strong>：SCL(serial clock)和SDA(serial data)，通过英文定义我们大概可以知道SCL对应时钟，SDA则与数据传输相关。</p>
</li>
<li>
<p><strong>同步</strong>：同步时序需要一根时钟线指导数据读写，因此它可以支持读写过程中的暂停，对硬件电路的依赖程度比较低；与之对应的<strong>异步时序</strong>则不需要时钟线，节省了部分资源，但是它对数据传输的速率和时间都有十分严格的要求，依赖硬件电路的支持。</p>
</li>
<li>
<p><strong>半双工</strong>：发送和接收数据共用一根线（SDA），可双向传输；而<strong>全双工</strong>需要发送和接收两条线，<strong>单工</strong>则只能单向传输。</p>
</li>
<li>
<p><strong>总线可接入多设备</strong>：一主多从、多主多从。</p>
</li>
<li>
<p><strong>应用</strong>：广泛应用于MPU6050、OLED、AT24CO2等电子模块。</p>
</li>
</ul>
<h2 id="i2c时序">I2C时序
</h2><h3 id="基本单元">基本单元
</h3><ul>
<li>
<p>发送一个字节：发送字节时，SCL、SDA全程由主机控制。低电平时主机放数据，高电平时从机读数据。</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202132302650.png"
	width="1184"
	height="571"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202132302650_hu1955486248613274823.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202132302650_hu16846804856568149607.png 1024w"
	loading="lazy"
	
		alt="image-20231202132302650"
	
	
		class="gallery-image" 
		data-flex-grow="207"
		data-flex-basis="497px"
	
></p>
</li>
<li>
<p>接收一个字节：低电平时从机放数据，高电平时主机读数据。</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202133146111.png"
	width="1247"
	height="621"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202133146111_hu12584441417698073643.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202133146111_hu12728915665899041158.png 1024w"
	loading="lazy"
	
		alt="image-20231202133146111"
	
	
		class="gallery-image" 
		data-flex-grow="200"
		data-flex-basis="481px"
	
></p>
</li>
<li>
<p>发送应答与接收应答：主机接收后发送；主机发送后接收。</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202133550091.png"
	width="1185"
	height="639"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202133550091_hu16553617165888666870.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202133550091_hu13922646009839214522.png 1024w"
	loading="lazy"
	
		alt="image-20231202133550091"
	
	
		class="gallery-image" 
		data-flex-grow="185"
		data-flex-basis="445px"
	
></p>
</li>
</ul>
<h3 id="时序实例">时序实例
</h3><ul>
<li>
<p>指定地址写</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202134404527.png"
	width="1570"
	height="792"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202134404527_hu5065808490375794823.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202134404527_hu13057555761100737303.png 1024w"
	loading="lazy"
	
		alt="image-20231202134404527"
	
	
		class="gallery-image" 
		data-flex-grow="198"
		data-flex-basis="475px"
	
></p>
</li>
<li>
<p>当前地址读</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202134724720.png"
	width="1394"
	height="782"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202134724720_hu3900628796441607201.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202134724720_hu3146868004957635367.png 1024w"
	loading="lazy"
	
		alt="image-20231202134724720"
	
	
		class="gallery-image" 
		data-flex-grow="178"
		data-flex-basis="427px"
	
></p>
</li>
<li>
<p>指定地址读（复合而成）</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202134855541.png"
	width="1292"
	height="524"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202134855541_hu12190863462571856929.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202134855541_hu12292623753731538499.png 1024w"
	loading="lazy"
	
		alt="image-20231202134855541"
	
	
		class="gallery-image" 
		data-flex-grow="246"
		data-flex-basis="591px"
	
></p>
</li>
</ul>
<h1 id="软件i2c实现mpu6050数据读写">软件I2C实现MPU6050数据读写
</h1><p>前面我们提到MPU6050使用的是I2C通信协议，那么就需要找到SCL和SDA引脚，查找STM32F103C8T6引脚定义图可以知道这两个GPIO口分别为PB10、PB11。</p>
<h2 id="mpu5060寄存器配置">MPU5060寄存器配置
</h2><h3 id="采样频率分频器smprt_div">采样频率分频器SMPRT_DIV
</h3><p>主要与数据刷新的快慢相关，</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202143442976.png"
	width="629"
	height="99"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202143442976_hu1839145434677540246.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202143442976_hu14790656899602287869.png 1024w"
	loading="lazy"
	
		alt="image-20231202143442976"
	
	
		class="gallery-image" 
		data-flex-grow="635"
		data-flex-basis="1524px"
	
></p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202143514236.png"
	width="645"
	height="53"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202143514236_hu10961795472818408357.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202143514236_hu5485030861477318272.png 1024w"
	loading="lazy"
	
		alt="image-20231202143514236"
	
	
		class="gallery-image" 
		data-flex-grow="1216"
		data-flex-basis="2920px"
	
></p>
<p>本次实验以陀螺仪晶振为例，不使用8KHz外部晶振，使用1kHz的晶振，故需启用DLPF。</p>
<h3 id="配置寄存器config">配置寄存器CONFIG
</h3><p>主要考虑低通滤波器设置部分，即下图的0-2位。</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202143753744.png"
	width="638"
	height="105"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202143753744_hu7558329041019677811.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202143753744_hu18335207849649482377.png 1024w"
	loading="lazy"
	
		alt="image-20231202143753744"
	
	
		class="gallery-image" 
		data-flex-grow="607"
		data-flex-basis="1458px"
	
></p>
<h3 id="陀螺仪配置寄存器gyro_config">陀螺仪配置寄存器GYRO_CONFIG
</h3><p>第5-7位控制陀螺仪的自检（self test）；第3、4位控制满量程的选择，满量程可以根据实际使用进行调节，使得实验数据更加精确。</p>
<blockquote>
<p>类似于高中电路实验电表的选择？</p>
</blockquote>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202144106224.png"
	width="628"
	height="101"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202144106224_hu15518479808623319305.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202144106224_hu5199574537763186765.png 1024w"
	loading="lazy"
	
		alt="image-20231202144106224"
	
	
		class="gallery-image" 
		data-flex-grow="621"
		data-flex-basis="1492px"
	
></p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202145039950.png"
	width="223"
	height="113"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202145039950_hu1622995717324948068.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202145039950_hu16547940533854993602.png 1024w"
	loading="lazy"
	
		alt="image-20231202145039950"
	
	
		class="gallery-image" 
		data-flex-grow="197"
		data-flex-basis="473px"
	
></p>
<h3 id="加速度计配置寄存器accel_config">加速度计配置寄存器ACCEL_CONFIG
</h3><p>大致与陀螺仪配置寄存器相同，但是0-1位还可以用来配置高通滤波。</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202144459675.png"
	width="629"
	height="100"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202144459675_hu1088699813567046378.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202144459675_hu2478362475856275624.png 1024w"
	loading="lazy"
	
		alt="image-20231202144459675"
	
	
		class="gallery-image" 
		data-flex-grow="629"
		data-flex-basis="1509px"
	
></p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202145459303.png"
	width="202"
	height="99"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202145459303_hu6428651536036496235.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202145459303_hu4514465934183350153.png 1024w"
	loading="lazy"
	
		alt="image-20231202145459303"
	
	
		class="gallery-image" 
		data-flex-grow="204"
		data-flex-basis="489px"
	
></p>
<h3 id="数据寄存器加速度陀螺仪温度计等">数据寄存器（加速度、陀螺仪、温度计等）
</h3><p>​	这几个寄存器类型为只读，可以读取加速度、角加速度、温度等原始信息。</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202142020184.png"
	width="784"
	height="268"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202142020184_hu14940450855883450931.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202142020184_hu5769958842122457970.png 1024w"
	loading="lazy"
	
		alt="image-20231202142020184"
	
	
		class="gallery-image" 
		data-flex-grow="292"
		data-flex-basis="702px"
	
></p>
<h2 id="库函数代码配置">库函数代码配置
</h2><h3 id="sclsda的读写函数">SCL、SDA的读写函数
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//SCL写入
</span></span><span class="line"><span class="cl">void MyI2C_W_SCL(uint8_t Bitvalue)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	GPIO_WriteBit(GPIOB,GPIO_Pin_10,(BitAction)Bitvalue);
</span></span><span class="line"><span class="cl">	Delay_us(10);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//SDA写入
</span></span><span class="line"><span class="cl">void MyI2C_W_SDA(uint8_t Bitvalue)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	GPIO_WriteBit(GPIOB,GPIO_Pin_11,(BitAction)Bitvalue);
</span></span><span class="line"><span class="cl">	Delay_us(10);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//SDA读取
</span></span><span class="line"><span class="cl">uint8_t MyI2C_R_SDA(void)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	uint8_t Bitvalue;
</span></span><span class="line"><span class="cl">	Bitvalue=GPIO_ReadInputDataBit(GPIOB,GPIO_Pin_11);
</span></span><span class="line"><span class="cl">	Delay_us(10);
</span></span><span class="line"><span class="cl">	return Bitvalue;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="起始和终止函数">起始和终止函数
</h3><p>在SCL、SDA读写函数完成后，可以配置I2C通信协议的起止函数驱动：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void MyI2C_Start(void)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	MyI2C_W_SDA(1);
</span></span><span class="line"><span class="cl">	MyI2C_W_SCL(1);
</span></span><span class="line"><span class="cl">	MyI2C_W_SDA(0);//先拉低SDA，后SCL.
</span></span><span class="line"><span class="cl">	MyI2C_W_SCL(0);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">void MyI2C_Stop(void)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	MyI2C_W_SDA(0);
</span></span><span class="line"><span class="cl">	MyI2C_W_SCL(1);
</span></span><span class="line"><span class="cl">	MyI2C_W_SDA(1);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>在开始时先把SCL和SDA都拉高（置1）。考虑到结束时SDA数据并不总是低电平，为重复起始条件，需手动把SDA线先拉低到低电平，再操作SCL线；同样地，终止时SDA不总是低电平，需先将SDA拉低，再将其拉高完成终止操作。</p>
<p>简单来说就是，在SCL时钟线高电平的期间，SDA数据线不能有任何电平的翻转，若SCL时钟线高电平的期间SDA从低电平拉到高电平则重复开始，从高电平拉到低电平则会认为此时发送数据已结束。</p>
<h3 id="i2c发送与接收数据">I2C发送与接收数据
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//发送8字节
</span></span><span class="line"><span class="cl">void MyI2C_SendByte(uint8_t Byte)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	uint8_t i;
</span></span><span class="line"><span class="cl">	for (i = 0; i &lt; 8; i ++)
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		MyI2C_W_SDA(Byte &amp; (0x80 &gt;&gt; i));
</span></span><span class="line"><span class="cl">		MyI2C_W_SCL(1);
</span></span><span class="line"><span class="cl">		MyI2C_W_SCL(0);
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//接收部分
</span></span><span class="line"><span class="cl">uint8_t MyI2C_ReceiveByte(void)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	uint8_t i, Byte = 0x00;
</span></span><span class="line"><span class="cl">	MyI2C_W_SDA(1);//释放SDA
</span></span><span class="line"><span class="cl">	for (i = 0; i &lt; 8; i ++)
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		MyI2C_W_SCL(1);
</span></span><span class="line"><span class="cl">		if (MyI2C_R_SDA() == 1){Byte |= (0x80 &gt;&gt; i);}
</span></span><span class="line"><span class="cl">		MyI2C_W_SCL(0);
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	return Byte;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>发送数据时高位先行，发送结束后SCL置低电平；接收数据时同样是高位先行，接收结束后SCL置0。</p>
<h3 id="发送与接收应答">发送与接收应答
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void MyI2C_SendAck(uint8_t AckBit)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	MyI2C_W_SDA(AckBit);
</span></span><span class="line"><span class="cl">	MyI2C_W_SCL(1);
</span></span><span class="line"><span class="cl">	MyI2C_W_SCL(0);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">uint8_t MyI2C_ReceiveAck(void)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	uint8_t AckBit;
</span></span><span class="line"><span class="cl">	MyI2C_W_SDA(1);
</span></span><span class="line"><span class="cl">	MyI2C_W_SCL(1);
</span></span><span class="line"><span class="cl">	AckBit = MyI2C_R_SDA();
</span></span><span class="line"><span class="cl">	MyI2C_W_SCL(0);
</span></span><span class="line"><span class="cl">	return AckBit;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>主机在接收完一个字节之后，在下一个时钟发送一位数据，数据0表示应答，数据1表示非应答；发送完一个字节之后，在下一个时钟接收一位数据，判断从机是否应答，数据0表示应答，数据1表示非应答（主机在接收之前，需要释放SDA）。</p>
<h3 id="读写mpu6050的寄存器">读写MPU6050的寄存器
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//写寄存器
</span></span><span class="line"><span class="cl">void MPU6050_WriteReg(uint8_t RegAddress,uint8_t Data)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	MyI2C_Start();
</span></span><span class="line"><span class="cl">	MyI2C_SendByte(MPU6050_ADDRESS);
</span></span><span class="line"><span class="cl">	MyI2C_ReceiveAck();
</span></span><span class="line"><span class="cl">	MyI2C_SendByte(RegAddress);
</span></span><span class="line"><span class="cl">	MyI2C_ReceiveAck();
</span></span><span class="line"><span class="cl">	MyI2C_SendByte(Data);
</span></span><span class="line"><span class="cl">	MyI2C_ReceiveAck();
</span></span><span class="line"><span class="cl">	MyI2C_Stop();
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//读寄存器
</span></span><span class="line"><span class="cl">uint8_t MPU6050_ReadReg(uint8_t RegAddress)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	uint8_t Data;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	MyI2C_Start();
</span></span><span class="line"><span class="cl">	MyI2C_SendByte(MPU6050_ADDRESS);
</span></span><span class="line"><span class="cl">	MyI2C_ReceiveAck();
</span></span><span class="line"><span class="cl">	MyI2C_SendByte(RegAddress);
</span></span><span class="line"><span class="cl">	MyI2C_ReceiveAck();
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	MyI2C_Start();
</span></span><span class="line"><span class="cl">	MyI2C_SendByte(MPU6050_ADDRESS | 0x01);
</span></span><span class="line"><span class="cl">	MyI2C_ReceiveAck();
</span></span><span class="line"><span class="cl">	Data=MyI2C_ReceiveByte();
</span></span><span class="line"><span class="cl">	MyI2C_SendAck(1);
</span></span><span class="line"><span class="cl">	MyI2C_Stop();
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	return Data;
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>写寄存器的具体过程是：</p>
<ol>
<li>
<p>开始</p>
</li>
<li>
<p>主机发送MPU6050地址</p>
</li>
<li>
<p>收到应答位</p>
</li>
<li>
<p>发送寄存器地址</p>
</li>
<li>
<p>收到应答位</p>
</li>
<li>
<p>发送数据</p>
</li>
<li>
<p>收到应答位</p>
</li>
<li>
<p>结束</p>
<p>每发送一次数据，都要接收相应的应答位，之后继续发送或是停止。</p>
</li>
</ol>
<p>读寄存器过程大致相同，区别只是在于刚开始时要写一下MPU6050设备地址，相当于喊一下MPU6050，告知它我们要和它进行通讯了。</p>
<h3 id="mpu6050初始化">MPU6050初始化
</h3><p>在完成了MPU6050读写寄存器函数的配置后，我们就可以开始对MPU6050进行初始化。</p>
<p>需要写的寄存器有电源管理寄存器1、2，采样频率分频器，配置寄存器，陀螺仪配置寄存器，加速度配置寄存器。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void MPU6050_Init(void)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	MyI2C_Init();
</span></span><span class="line"><span class="cl">	MPU6050_WriteReg(MPU6050_PWR_MGMT_1,0x01);
</span></span><span class="line"><span class="cl">	MPU6050_WriteReg(MPU6050_PWR_MGMT_2,0x00);
</span></span><span class="line"><span class="cl">	MPU6050_WriteReg(MPU6050_SMPLRT_DIV,0x09);
</span></span><span class="line"><span class="cl">	MPU6050_WriteReg(MPU6050_CONFIG,0x06);
</span></span><span class="line"><span class="cl">	MPU6050_WriteReg(MPU6050_GYRO_CONFIG,0x18);
</span></span><span class="line"><span class="cl">	MPU6050_WriteReg(MPU6050_ACCEL_CONFIG,0x18);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="读取mpu6050数据">读取MPU6050数据
</h3><p>通过读取前面所提到的数据寄存器，获取有符号的16位整型加速度、角加速度信息。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//也可指定一个基地址，读取连续一片地址
</span></span><span class="line"><span class="cl">void MPU6050_GetData(int16_t *AccX, int16_t *AccY, int16_t *AccZ, 
</span></span><span class="line"><span class="cl">						int16_t *GyroX, int16_t *GyroY, int16_t *GyroZ)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	uint8_t DataH, DataL;
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	DataH = MPU6050_ReadReg(MPU6050_ACCEL_XOUT_H);
</span></span><span class="line"><span class="cl">	DataL = MPU6050_ReadReg(MPU6050_ACCEL_XOUT_L);
</span></span><span class="line"><span class="cl">	*AccX = (DataH &lt;&lt; 8) | DataL;
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	DataH = MPU6050_ReadReg(MPU6050_ACCEL_YOUT_H);
</span></span><span class="line"><span class="cl">	DataL = MPU6050_ReadReg(MPU6050_ACCEL_YOUT_L);
</span></span><span class="line"><span class="cl">	*AccY = (DataH &lt;&lt; 8) | DataL;
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	DataH = MPU6050_ReadReg(MPU6050_ACCEL_ZOUT_H);
</span></span><span class="line"><span class="cl">	DataL = MPU6050_ReadReg(MPU6050_ACCEL_ZOUT_L);
</span></span><span class="line"><span class="cl">	*AccZ = (DataH &lt;&lt; 8) | DataL;
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	DataH = MPU6050_ReadReg(MPU6050_GYRO_XOUT_H);
</span></span><span class="line"><span class="cl">	DataL = MPU6050_ReadReg(MPU6050_GYRO_XOUT_L);
</span></span><span class="line"><span class="cl">	*GyroX = (DataH &lt;&lt; 8) | DataL;
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	DataH = MPU6050_ReadReg(MPU6050_GYRO_YOUT_H);
</span></span><span class="line"><span class="cl">	DataL = MPU6050_ReadReg(MPU6050_GYRO_YOUT_L);
</span></span><span class="line"><span class="cl">	*GyroY = (DataH &lt;&lt; 8) | DataL;
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	DataH = MPU6050_ReadReg(MPU6050_GYRO_ZOUT_H);
</span></span><span class="line"><span class="cl">	DataL = MPU6050_ReadReg(MPU6050_GYRO_ZOUT_L);
</span></span><span class="line"><span class="cl">	*GyroZ = (DataH &lt;&lt; 8) | DataL;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>需要注意的是，获取器件ID号的部分函数是uint8_t的定义类型，需要单独封装。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">uint8_t MPU6050_GetID(void)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	return MPU6050_ReadReg(MPU6050_WHO_AM_I);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="主函数编写">主函数编写
</h3><p>为了检验数据是否能正常采集，在OLED初始化过后，在主函数中调用MPU6050及相关函数，将数据显示到OLED显示屏上面。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#include &#34;stm32f10x.h&#34;                 
</span></span><span class="line"><span class="cl">#include &#34;Delay.h&#34;
</span></span><span class="line"><span class="cl">#include &#34;OLED.h&#34;
</span></span><span class="line"><span class="cl">#include &#34;MPU6050.h&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">uint8_t ID;
</span></span><span class="line"><span class="cl">int16_t AX, AY, AZ, GX, GY, GZ;
</span></span><span class="line"><span class="cl">//分层编写与测验代码
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">int main(void)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	OLED_Init();
</span></span><span class="line"><span class="cl">	MPU6050_Init();
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	OLED_ShowString(1, 1, &#34;ID:&#34;);
</span></span><span class="line"><span class="cl">	ID = MPU6050_GetID();
</span></span><span class="line"><span class="cl">	OLED_ShowHexNum(1, 4, ID, 2);
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	while (1)
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		MPU6050_GetData(&amp;AX, &amp;AY, &amp;AZ, &amp;GX, &amp;GY, &amp;GZ);
</span></span><span class="line"><span class="cl">		OLED_ShowSignedNum(2, 1, AX, 5);
</span></span><span class="line"><span class="cl">		OLED_ShowSignedNum(3, 1, AY, 5);
</span></span><span class="line"><span class="cl">		OLED_ShowSignedNum(4, 1, AZ, 5);
</span></span><span class="line"><span class="cl">		OLED_ShowSignedNum(2, 8, GX, 5);
</span></span><span class="line"><span class="cl">		OLED_ShowSignedNum(3, 8, GY, 5);
</span></span><span class="line"><span class="cl">		OLED_ShowSignedNum(4, 8, GZ, 5);
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>具体效果如下图所示：</p>
<img src="../../../../../../../../administractor Cheng/Desktop/markdown/挑战一：裸机下驱动MPU6050.assets/image-20231202161603601.png" alt="image-20231202161603601" style="zoom:50%;" />
<h1 id="读取数据经蓝牙发送">读取数据经蓝牙发送
</h1><h2 id="库函数实现usart串口初始化">库函数实现USART串口初始化
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">void Serial_Init(void)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1, ENABLE);//开启USART1的时钟
</span></span><span class="line"><span class="cl">	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);//GPIOA时钟使能
</span></span><span class="line"><span class="cl">	GPIO_PinRemapConfig(GPIO_Remap_USART1,ENABLE);//添加部分，GPIO口复用
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	GPIO_InitTypeDef GPIO_InitStructure;
</span></span><span class="line"><span class="cl">	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;//复用推挽输出
</span></span><span class="line"><span class="cl">	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_9;
</span></span><span class="line"><span class="cl">	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
</span></span><span class="line"><span class="cl">	GPIO_Init(GPIOA, &amp;GPIO_InitStructure);
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	USART_InitTypeDef USART_InitStructure;
</span></span><span class="line"><span class="cl">	USART_InitStructure.USART_BaudRate = 9600;
</span></span><span class="line"><span class="cl">	USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;
</span></span><span class="line"><span class="cl">	USART_InitStructure.USART_Mode = USART_Mode_Tx;//仅配置接收TX
</span></span><span class="line"><span class="cl">	USART_InitStructure.USART_Parity = USART_Parity_No;
</span></span><span class="line"><span class="cl">	USART_InitStructure.USART_StopBits = USART_StopBits_1;
</span></span><span class="line"><span class="cl">	USART_InitStructure.USART_WordLength = USART_WordLength_8b;
</span></span><span class="line"><span class="cl">	USART_Init(USART1, &amp;USART_InitStructure);
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	USART_Cmd(USART1, ENABLE);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于蓝牙串口发送暂时不需要RX引脚（即PA10），上面部分代码仅配置了PA9引脚，字长为8字节，停止位1，无校验位。</p>
<h2 id="编写串口发送函数">编写串口发送函数
</h2><p>通过查找相应库函数，可以完成发送一个字节的功能。</p>
<p>串口发送的函数其实就是向DR寄存器写入数据，<em>Data&amp;(uint16_t)0x01FF</em>实现DR寄存器无关的高位清零；实际发送时，TDR寄存器把数据一位一位地转到移位寄存器中，如果发送过快，可能会产生数据覆写等错误，为了避免产生，我们需要调用函数<em>FlagStatus USART_GetFlagStatus</em>获取标志位，直到TXE标志位置<em>SET</em>时停止循环。</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202165409913.png"
	width="790"
	height="222"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202165409913_hu9115741487280417885.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202165409913_hu12470507306216204751.png 1024w"
	loading="lazy"
	
		alt="image-20231202165409913"
	
	
		class="gallery-image" 
		data-flex-grow="355"
		data-flex-basis="854px"
	
></p>
<p>​		<img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202214240563.png"
	width="1000"
	height="522"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202214240563_hu15727333957508570821.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202214240563_hu12403191105152478102.png 1024w"
	loading="lazy"
	
		alt="image-20231202214240563"
	
	
		class="gallery-image" 
		data-flex-grow="191"
		data-flex-basis="459px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//发送一个字节
</span></span><span class="line"><span class="cl">void Serial_SendByte(uint8_t Byte)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	USART_SendData(USART1, Byte);
</span></span><span class="line"><span class="cl">	while (USART_GetFlagStatus(USART1, USART_FLAG_TXE) == RESET);//再次写入时，标志位自动清零，所以不需要手动
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样就可以通过*Serial_SendByte()<em>发送“+”和“-”以及封装发送数据的其他函数，后面r</em>会用到。</p>
<h2 id="printf函数的重定向">printf函数的重定向
</h2><p>通过printf函数的重定向，我们可以实现printf打印输出串口数据，当然使用封装<em>Serial_SendByte</em>的<em>Serial_SendString</em>也可以达到目的。</p>
<p>注意加上头文件<em>include &lt;stdio.h&gt;</em>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//对printf函数进行重定向，以使用printf
</span></span><span class="line"><span class="cl">int fputc(int ch, FILE *f)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	Serial_SendByte(ch);
</span></span><span class="line"><span class="cl">	return ch;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="封装mpu6050数据发送函数">封装MPU6050数据发送函数
</h2><p>之前我们已经实现了OLED显示屏上打印读取的ACC和GYRO数据，其中如何将一串有符号数字打印出来呢？</p>
<p>可以参考一下以下库函数代码的思路：</p>
<p>对于一个多位数12345，12345/10000%10=1，12345/1000%10=2，12345/100%10=3，12345/10%10=4，也就是说我们可以通过整除和取余相结合，一个一个地取出类似的多位数的每一位。</p>
<p>下列<em>OLED_Pow</em>函数可以实现X的Y次方的计算，之后循环取出每一位就可以打印出数据。</p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202225804800.png"
	width="612"
	height="237"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202225804800_hu13483283409300206542.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202225804800_hu4698182059536951772.png 1024w"
	loading="lazy"
	
		alt="image-20231202225804800"
	
	
		class="gallery-image" 
		data-flex-grow="258"
		data-flex-basis="619px"
	
></p>
<p><img src="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202225526268.png"
	width="1264"
	height="456"
	srcset="/p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202225526268_hu2516668091493612191.png 480w, /p/stm32%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0%E4%B8%80mpu6050%E6%A8%A1%E5%9D%97/index.assets/image-20231202225526268_hu5474971423562020654.png 1024w"
	loading="lazy"
	
		alt="image-20231202225526268"
	
	
		class="gallery-image" 
		data-flex-grow="277"
		data-flex-basis="665px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//次方函数
</span></span><span class="line"><span class="cl">uint32_t Serial_Pow(uint32_t X, uint32_t Y)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	uint32_t Result = 1;
</span></span><span class="line"><span class="cl">	while (Y --)
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		Result *= X;//X^Y
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	return Result;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">//发送ACC、GYRO数据
</span></span><span class="line"><span class="cl">void serial_print_MPU6050data(int32_t Number, uint8_t Length)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	uint8_t i;
</span></span><span class="line"><span class="cl">	uint32_t Number1;
</span></span><span class="line"><span class="cl">	if (Number &gt;= 0)
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		Serial_SendByte( &#39;+&#39;);
</span></span><span class="line"><span class="cl">		Number1 = Number;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	else
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		Serial_SendByte( &#39;-&#39;);
</span></span><span class="line"><span class="cl">		Number1 = -Number;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	for (i = 0; i &lt; Length; i++)							
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		Serial_SendByte(Number1 / Serial_Pow(10, Length - i - 1) % 10 + &#39;0&#39;);
</span></span><span class="line"><span class="cl">		//“/10”实现取左边，“%10”实现取右边；为了以字符形式一串行地显示，加上偏移&#39;0&#39;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	printf(&#34;\r\n&#34;);//回车换行
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="主函数编写-1">主函数编写
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">int main(void)
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">	MPU6050_Init();
</span></span><span class="line"><span class="cl">	Serial_Init();
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	while (1)
</span></span><span class="line"><span class="cl">	{
</span></span><span class="line"><span class="cl">		MPU6050_GetData(&amp;AX, &amp;AY, &amp;AZ, &amp;GX, &amp;GY, &amp;GZ);
</span></span><span class="line"><span class="cl">		printf(&#34;ACC:\r\n&#34;);
</span></span><span class="line"><span class="cl">		serial_print_MPU6050data(AX,6);
</span></span><span class="line"><span class="cl">		serial_print_MPU6050data(AY,6);
</span></span><span class="line"><span class="cl">		serial_print_MPU6050data(AZ,6);
</span></span><span class="line"><span class="cl">		printf(&#34;GYRO:\r\n&#34;);
</span></span><span class="line"><span class="cl">		serial_print_MPU6050data(GX,6);
</span></span><span class="line"><span class="cl">		serial_print_MPU6050data(GY,6);
</span></span><span class="line"><span class="cl">		serial_print_MPU6050data(GZ,6);
</span></span><span class="line"><span class="cl">		Delay_ms(1000);//延时1秒
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>最后在手机端蓝牙调试助手实现收发。</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2024 KiWiT
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.27.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
